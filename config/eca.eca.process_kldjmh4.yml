uuid: b7237b83-41c4-480d-88f9-1a18b6abdf8e
langcode: en
status: true
dependencies:
  config:
    - field.field.node.vacation_request.field_duration_example
    - field.field.node.vacation_request.field_duration_not_paid_vacation
    - field.field.node.vacation_request.field_duration_notpaid_in_hours
    - field.field.node.vacation_request.field_duration_of_the_paid_vacat
    - field.field.node.vacation_request.field_employee_sender
    - field.storage.node.field_duration_example
    - field.storage.node.field_duration_not_paid_vacation
    - field.storage.node.field_duration_notpaid_in_hours
    - field.storage.node.field_duration_of_the_paid_vacat
    - field.storage.node.field_employee_sender
    - node.type.vacation_request
  module:
    - eca_base
    - eca_content
    - eca_tamper
    - eca_user
id: process_kldjmh4
modeller: bpmn_io
label: 'Duration vacation days and send message to approver'
version: ''
weight: null
events:
  Event_1r3ba0r:
    plugin: 'content_entity:insert'
    label: 'create vacation request'
    configuration:
      type: 'node vacation_request'
    successors:
      -
        id: Activity_0c3pcf2
        condition: ''
conditions:
  Flow_1at95zf:
    plugin: eca_count
    configuration:
      negate: false
      case: false
      left: all_approvers
      right: '0'
      operator: greaterthan
      type: numeric
gateways:
  Gateway_0l452un:
    type: 0
    successors:
      -
        id: Activity_0g2xxt5
        condition: ''
      -
        id: Activity_17cjcqu
        condition: ''
      -
        id: Activity_1jrx8jo
        condition: ''
  Gateway_0zzcmmf:
    type: 0
    successors:
      -
        id: Activity_1vxsrnu
        condition: Flow_1at95zf
actions:
  Activity_0c3pcf2:
    plugin: eca_token_load_entity
    label: 'load request'
    configuration:
      token_name: new_request
      from: current
      entity_type: node
      entity_id: ''
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: ''
    successors:
      -
        id: Activity_0c4vplg
        condition: ''
      -
        id: Activity_1w3fjd1
        condition: ''
  Activity_0c4vplg:
    plugin: eca_switch_account
    label: 'switch user'
    configuration:
      user_id: '1'
    successors:
      -
        id: Gateway_0l452un
        condition: ''
  Activity_17cjcqu:
    plugin: 'eca_tamper:math'
    label: 'duration timestamp paid vacation'
    configuration:
      operation: subtraction
      flip: false
      value: '[new_request:field_duration_example:value]'
      eca_data: '[new_request:field_duration_example:end_value]'
      eca_token_name: duration_timestamp_paid_vacation
    successors:
      -
        id: Activity_1ct2c1l
        condition: ''
  Activity_0g2xxt5:
    plugin: 'eca_tamper:math'
    label: 'duration timestamp not paid vacation'
    configuration:
      operation: subtraction
      flip: false
      value: '[new_request:field_duration_not_paid_vacation:value]'
      eca_data: '[new_request:field_duration_not_paid_vacation:end_value]'
      eca_token_name: duration_timestamp
    successors:
      -
        id: Activity_0qj364f
        condition: ''
  Activity_0qj364f:
    plugin: 'eca_tamper:math'
    label: 'duration in hours'
    configuration:
      operation: division
      flip: false
      value: '3600'
      eca_data: '[duration_timestamp]'
      eca_token_name: duration_in_hours
    successors:
      -
        id: Activity_056gn5r
        condition: ''
  Activity_056gn5r:
    plugin: eca_set_field_value
    label: 'set field Duration in hours'
    configuration:
      field_name: field_duration_notpaid_in_hours
      field_value: '[duration_in_hours]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: '[new_request]'
    successors:
      -
        id: Activity_07z4qu3
        condition: ''
  Activity_07z4qu3:
    plugin: eca_save_entity
    label: 'save entity'
    configuration:
      object: '[new_request]'
    successors: {  }
  Activity_1ct2c1l:
    plugin: 'eca_tamper:math'
    label: 'duration in days'
    configuration:
      operation: division
      flip: false
      value: '86400'
      eca_data: '[duration_timestamp_paid_vacation]'
      eca_token_name: duration_in_days
    successors:
      -
        id: Activity_15fq56m
        condition: ''
  Activity_15fq56m:
    plugin: eca_set_field_value
    label: 'set field Duration in days'
    configuration:
      field_name: field_duration_of_the_paid_vacat
      field_value: '[duration_in_days]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: '[new_request]'
    successors:
      -
        id: Activity_0gvmbur
        condition: ''
  Activity_0gvmbur:
    plugin: eca_save_entity
    label: 'save entity'
    configuration:
      object: '[new_request]'
    successors: {  }
  Activity_1jrx8jo:
    plugin: eca_set_field_value
    label: 'set field "Sender"'
    configuration:
      field_name: field_employee_sender
      field_value: '[new_request:author:uid]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: '[new_request]'
    successors: {  }
  Activity_0x2hsi1:
    plugin: action_message_action
    label: Activity_0x2hsi1
    configuration:
      replace_tokens: false
      message: '[all_approvers] -> в''юшка всі апруверів реквестів'
    successors: {  }
  Activity_1vxsrnu:
    plugin: eca_list_remove
    label: 'Drop user'
    configuration:
      value: ''
      token_name: first_approver
      method: first
      index: ''
      list_token: all_approvers
    successors:
      -
        id: Activity_0xwfy3a
        condition: ''
      -
        id: Activity_1hjxd58
        condition: ''
  Activity_0xwfy3a:
    plugin: eca_token_load_entity
    label: 'load user'
    configuration:
      token_name: approver
      from: id
      entity_type: user
      entity_id: '[first_approver:uid]'
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: '[all_approvers]'
    successors:
      -
        id: Activity_1hhgq2f
        condition: ''
      -
        id: Gateway_0zzcmmf
        condition: ''
      -
        id: Activity_0tieq5m
        condition: ''
  Activity_1hhgq2f:
    plugin: action_send_email_action
    label: email
    configuration:
      replace_tokens: false
      recipient: '[approver:mail]'
      subject: 'новий реквест на апрув'
      message: 'привіт, апрувни пліз'
    successors: {  }
  Activity_1hjxd58:
    plugin: action_message_action
    label: Activity_1hjxd58
    configuration:
      replace_tokens: false
      message: 'дропнули юзера [first_approver:uid]'
    successors: {  }
  Activity_0tieq5m:
    plugin: action_message_action
    label: Activity_0tieq5m
    configuration:
      replace_tokens: false
      message: 'завантажили юзера [approver]'
    successors: {  }
  Activity_1w3fjd1:
    plugin: action_message_action
    label: Activity_1w3fjd1
    configuration:
      replace_tokens: false
      message: 'модель тривалість: завантажили реквест'
    successors: {  }
