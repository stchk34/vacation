uuid: d859143f-4209-4ee3-b984-2439f7afac8d
langcode: en
status: true
dependencies:
  config:
    - field.field.node.transaction.field_actual_balance
    - field.field.node.transaction.field_days
    - field.field.node.transaction.field_owner
    - field.field.node.transaction.field_previous_balance
    - field.field.node.transaction.field_status_transactions
    - field.field.node.transaction.field_type_paid_vacation
    - field.field.node.transaction.field_vacat
    - field.field.node.vacation_request.field_approver
    - field.field.node.vacation_request.field_duration_of_the_paid_vacat
    - field.field.node.vacation_request.field_employee_sender
    - field.field.node.vacation_request.field_request_state
    - field.field.user.user.field_balance_a_vacations_day
    - field.storage.node.field_actual_balance
    - field.storage.node.field_approver
    - field.storage.node.field_days
    - field.storage.node.field_duration_of_the_paid_vacat
    - field.storage.node.field_employee_sender
    - field.storage.node.field_owner
    - field.storage.node.field_previous_balance
    - field.storage.node.field_request_state
    - field.storage.node.field_status_transactions
    - field.storage.node.field_type_paid_vacation
    - field.storage.node.field_vacat
    - field.storage.user.field_balance_a_vacations_day
    - node.type.transaction
    - node.type.vacation_request
    - views.view.transaction_in_request
    - views.view.vacation_request
  module:
    - eca_base
    - eca_content
    - eca_tamper
    - eca_user
    - eca_views
    - node
id: process_qlvr3yo
modeller: bpmn_io
label: 'Create transaction type spent'
version: ''
weight: null
events:
  Event_1hke6hk:
    plugin: 'content_entity:update'
    label: 'upd request'
    configuration:
      type: 'node vacation_request'
    successors:
      -
        id: Activity_1qjv9fh
        condition: ''
  Event_1ufu9o1:
    plugin: 'content_entity:custom'
    label: x3
    configuration:
      event_id: x3
    successors:
      -
        id: Activity_1y0n5m6
        condition: ''
conditions:
  Flow_1bllzfn:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[upd_request:field_request_state:value]'
      right: request_state_disapproved
      operator: equal
      type: value
  Flow_1g0buwi:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[upd_request:field_type_vacations:value]'
      right: '2'
      operator: equal
      type: value
  Flow_13rdgl5:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[upd_request:field_type_vacations:value]'
      right: '1'
      operator: equal
      type: value
  Flow_0u0hrd1:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[upd_request:field_request_state:value]'
      right: request_state_agree
      operator: equal
      type: value
  Flow_132sn0f:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[upd_request:field_request_state:value]'
      right: request_state_published
      operator: equal
      type: value
  Flow_0xpwm8i:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[count_agree_state]'
      right: '[count_approvers]'
      operator: equal
      type: value
gateways:
  Gateway_0okut2l:
    type: 0
    successors:
      -
        id: Activity_1jfzka7
        condition: Flow_1g0buwi
      -
        id: Activity_0g7rzjw
        condition: Flow_13rdgl5
  Gateway_16gn9ef:
    type: 0
    successors:
      -
        id: Activity_1ozf1jb
        condition: Flow_1bllzfn
      -
        id: Activity_158te4k
        condition: Flow_0u0hrd1
actions:
  Activity_177hcd7:
    plugin: eca_token_load_entity
    label: 'load request'
    configuration:
      token_name: upd_request
      from: current
      entity_type: _none
      entity_id: ''
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: ''
    successors:
      -
        id: Activity_1j2dkni
        condition: ''
      -
        id: Activity_0xoy079
        condition: ''
  Activity_0g7rzjw:
    plugin: eca_new_entity
    label: 'Transaction paid vacation'
    configuration:
      token_name: paid_vacation_transaction
      type: 'node transaction'
      langcode: ''
      label: 'Spent transaction to "[upd_request:title]"'
      published: true
      owner: '1'
    successors:
      -
        id: Activity_0k0dwho
        condition: ''
  Activity_1jfzka7:
    plugin: eca_new_entity
    label: 'Transaction not paid vacation'
    configuration:
      token_name: not_paid_vacation_transaction
      type: 'node transaction'
      langcode: ''
      label: 'Transaction to [upd_request:title]'
      published: true
      owner: '1'
    successors:
      -
        id: Activity_0tn1w01
        condition: ''
  Activity_1ozf1jb:
    plugin: 'entity:unpublish_action:node'
    label: 'Unpublish request'
    configuration:
      object: '[upd_request]'
    successors:
      -
        id: Activity_1qpa53k
        condition: ''
  Activity_0k0dwho:
    plugin: eca_set_field_value
    label: 'set field "owner"'
    configuration:
      field_name: field_owner
      field_value: '[sender_request]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: false
      object: '[paid_vacation_transaction]'
    successors:
      -
        id: Activity_0u96fty
        condition: ''
  Activity_0kxn1tx:
    plugin: eca_set_field_value
    label: 'set field " Spent type"'
    configuration:
      field_name: field_status_transactions
      field_value: transaction_type_spent
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: false
      object: '[paid_vacation_transaction]'
    successors:
      -
        id: Activity_0uqbkq6
        condition: ''
  Activity_0uqbkq6:
    plugin: eca_set_field_value
    label: 'set field "paid or not paid vacation"'
    configuration:
      field_name: field_type_paid_vacation
      field_value: Paid
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: false
      object: '[paid_vacation_transaction]'
    successors:
      -
        id: Activity_18cket8
        condition: ''
  Activity_0tn1w01:
    plugin: eca_set_field_value
    label: 'set field "owner"'
    configuration:
      field_name: field_owner
      field_value: '[upd_request:uid:entity]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: '[paid_vacation_transaction]'
    successors:
      -
        id: Activity_0k7cn0r
        condition: ''
  Activity_0k7cn0r:
    plugin: eca_set_field_value
    label: 'Set field "Spent type"'
    configuration:
      field_name: field_status_transactions
      field_value: transaction_type_spent
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: '[paid_vacation_transaction]'
    successors:
      -
        id: Activity_1ocw2lm
        condition: ''
  Activity_0apff12:
    plugin: eca_save_entity
    label: 'Save entity'
    configuration:
      object: '[paid_vacation_transaction]'
    successors:
      -
        id: Activity_1uzv1r9
        condition: ''
  Activity_1ocw2lm:
    plugin: eca_set_field_value
    label: 'Set field "Paid or not paid vacation"'
    configuration:
      field_name: field_type_paid_vacation
      field_value: Paid
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: '[paid_vacation_transaction]'
    successors:
      -
        id: Activity_0apff12
        condition: ''
  Activity_18cket8:
    plugin: eca_set_field_value
    label: 'set field Days'
    configuration:
      field_name: field_days
      field_value: '[upd_request:field_duration_of_the_paid_vacat:value]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: false
      object: '[paid_vacation_transaction]'
    successors:
      -
        id: Activity_0sb2lrt
        condition: ''
  Activity_0u96fty:
    plugin: eca_set_field_value
    label: 'set field "vacation request"'
    configuration:
      field_name: field_vacat
      field_value: '[upd_request]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: false
      object: '[paid_vacation_transaction]'
    successors:
      -
        id: Activity_0kxn1tx
        condition: ''
  Activity_1j2dkni:
    plugin: eca_token_load_entity_ref
    label: 'load entity user in vacation request'
    configuration:
      field_name_entity_ref: field_employee_sender
      token_name: sender_request
      from: current
      entity_type: user
      entity_id: ''
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: '[upd_request]'
    successors:
      -
        id: Activity_0s15svy
        condition: ''
      -
        id: Activity_19yi5bd
        condition: ''
  Activity_0s8462p:
    plugin: 'eca_tamper:math'
    label: 'calculate actual balance after vacation request'
    configuration:
      operation: subtraction
      flip: false
      value: '[paid_vacation_transaction:field_days:value]'
      eca_data: '[sender_request:field_balance_a_vacations_day:value]'
      eca_token_name: balance_after_request
    successors:
      -
        id: Activity_15hsrgz
        condition: ''
  Activity_15hsrgz:
    plugin: eca_set_field_value
    label: 'set field actual balance'
    configuration:
      field_name: field_balance_a_vacations_day
      field_value: '[balance_after_request]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: '[sender_request]'
    successors:
      -
        id: Activity_01irqi3
        condition: ''
  Activity_01irqi3:
    plugin: eca_save_entity
    label: 'save sender entity'
    configuration:
      object: '[sender_request]'
    successors:
      -
        id: Activity_0cg96c5
        condition: ''
  Activity_1qpa53k:
    plugin: action_message_action
    label: Activity_1qpa53k
    configuration:
      replace_tokens: false
      message: disapprove
    successors: {  }
  Activity_0sb2lrt:
    plugin: eca_set_field_value
    label: 'set Previous balance'
    configuration:
      field_name: field_previous_balance
      field_value: '[sender_request:field_balance_a_vacations_day:value]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: false
      object: '[paid_vacation_transaction]'
    successors:
      -
        id: Activity_1k4mghb
        condition: ''
  Activity_1k4mghb:
    plugin: 'eca_tamper:math'
    label: Activity_1k4mghb
    configuration:
      operation: subtraction
      flip: false
      value: '[upd_request:field_duration_of_the_paid_vacat:value]'
      eca_data: '[sender_request:field_balance_a_vacations_day:value]'
      eca_token_name: '[actual_balance]'
    successors:
      -
        id: Activity_05wdp8z
        condition: ''
  Activity_05wdp8z:
    plugin: eca_set_field_value
    label: Activity_05wdp8z
    configuration:
      field_name: field_actual_balance
      field_value: '[actual_balance]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: false
      object: '[paid_vacation_transaction]'
    successors:
      -
        id: Activity_1w5mj6m
        condition: ''
  Activity_0xg69ms:
    plugin: eca_trigger_content_entity_custom_event
    label: 'TRIGGER x3'
    configuration:
      event_id: x3
      tokens: 'sender_request,paid_vacation_transaction'
      object: '[paid_vacation_transaction]'
    successors:
      -
        id: Activity_1glvn30
        condition: ''
  Activity_1y0n5m6:
    plugin: eca_switch_account
    label: 'switch to admin'
    configuration:
      user_id: '1'
    successors:
      -
        id: Activity_0s8462p
        condition: ''
  Activity_1w5mj6m:
    plugin: eca_save_entity
    label: Activity_1w5mj6m
    configuration:
      object: '[paid_vacation_transaction]'
    successors:
      -
        id: Activity_0xg69ms
        condition: ''
  Activity_1glvn30:
    plugin: action_message_action
    label: message
    configuration:
      replace_tokens: false
      message: 'Ви апрувнули оплачуваний вакейшен реквест'
    successors: {  }
  Activity_1uzv1r9:
    plugin: action_message_action
    label: message
    configuration:
      replace_tokens: false
      message: 'Ви апрувнули неоплачуваний вакейшен реквест'
    successors: {  }
  Activity_0cg96c5:
    plugin: action_message_action
    label: Activity_0cg96c5
    configuration:
      replace_tokens: false
      message: 'Після Транзакції по списанню оновився баланс до [balance_after_request]'
    successors: {  }
  Activity_033h6g0:
    plugin: eca_views_query
    label: 'view" Vacation request"'
    configuration:
      token_name: list_approvers
      view_id: vacation_request
      display_id: block_1
      arguments: '[upd_request]'
    successors:
      -
        id: Activity_0msk7ry
        condition: ''
  Activity_0msk7ry:
    plugin: eca_count
    label: 'count approvers in view'
    configuration:
      token_name: count_approvers
      list_token: list_approvers
    successors:
      -
        id: Activity_1a634e9
        condition: ''
  Activity_1a634e9:
    plugin: eca_token_set_value
    label: 'count as token'
    configuration:
      token_name: countt
      token_value: '[count_approvers]'
      use_yaml: false
    successors:
      -
        id: Activity_0tr5xrc
        condition: ''
  Activity_158te4k:
    plugin: eca_set_field_value
    label: 'Revert state'
    configuration:
      field_name: field_request_state
      field_value: request_state_published
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: '[upd_request]'
    successors:
      -
        id: Activity_033h6g0
        condition: Flow_132sn0f
      -
        id: Activity_16ggdcc
        condition: ''
  Activity_16ggdcc:
    plugin: action_message_action
    label: Activity_16ggdcc
    configuration:
      replace_tokens: false
      message: |-
        статус вакейшен реквест повернуто до Пабліш
        вивід цього статуса = [upd_request:field_request_state:value]
    successors: {  }
  Activity_0tr5xrc:
    plugin: eca_views_query
    label: 'View "agree transaction in request"'
    configuration:
      token_name: process_request
      view_id: transaction_in_request
      display_id: block_1
      arguments: '[upd_request]'
    successors:
      -
        id: Activity_0hq8t9n
        condition: ''
  Activity_0hq8t9n:
    plugin: eca_count
    label: count
    configuration:
      token_name: count_agree_state
      list_token: process_request
    successors:
      -
        id: Activity_1374ch1
        condition: ''
      -
        id: Activity_0zuv8kp
        condition: Flow_0xpwm8i
  Activity_1374ch1:
    plugin: action_message_action
    label: message
    configuration:
      replace_tokens: false
      message: |-
        model upd request:[count_approvers] -> кількість апруверів в вакейшен реквесті
        [count_agree_state] -> кількість погоджень реквеста
    successors: {  }
  Activity_0zuv8kp:
    plugin: eca_set_field_value
    label: 'revert state'
    configuration:
      field_name: field_request_state
      field_value: request_state_approved
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: '[upd_request]'
    successors:
      -
        id: Gateway_0okut2l
        condition: ''
  Activity_0xoy079:
    plugin: action_message_action
    label: Activity_0xoy079
    configuration:
      replace_tokens: false
      message: |-
        реквест апдейтнувся до статусу:[upd_request:field_request_state:value]
        [upd_request]
    successors: {  }
  Activity_0s15svy:
    plugin: action_message_action
    label: Activity_0s15svy
    configuration:
      replace_tokens: false
      message: '[sender_request] ауаууауау'
    successors: {  }
  Activity_10uuqtw:
    plugin: eca_switch_account
    label: 'switch to current user'
    configuration:
      user_id: '[user]'
    successors:
      -
        id: Activity_0zr6k8o
        condition: ''
      -
        id: Activity_1ae4x2p
        condition: ''
  Activity_0zr6k8o:
    plugin: eca_list_remove
    label: 'remo approver'
    configuration:
      value: '[user]'
      token_name: disabled_user
      method: first
      index: ''
      list_token: approvers
    successors:
      -
        id: Activity_1q4i89a
        condition: ''
  Activity_19yi5bd:
    plugin: eca_token_set_value
    label: 'set value'
    configuration:
      token_name: approver
      token_value: '[upd_request:field_approver]'
      use_yaml: false
    successors:
      -
        id: Activity_1dw2rv9
        condition: ''
      -
        id: Activity_10uuqtw
        condition: ''
  Activity_1dw2rv9:
    plugin: action_message_action
    label: Activity_1dw2rv9
    configuration:
      replace_tokens: false
      message: |-
        список всіх апруверів [approver]
        один апрувер
    successors: {  }
  Activity_1ae4x2p:
    plugin: action_message_action
    label: Activity_1ae4x2p
    configuration:
      replace_tokens: false
      message: 'action завантажили поточного юзера [user]'
    successors: {  }
  Activity_1q4i89a:
    plugin: eca_switch_account
    label: Activity_1q4i89a
    configuration:
      user_id: '1'
    successors:
      -
        id: Gateway_16gn9ef
        condition: ''
  Activity_0trx6uy:
    plugin: eca_switch_account
    label: Activity_0trx6uy
    configuration:
      user_id: '1'
    successors:
      -
        id: Activity_177hcd7
        condition: ''
  Activity_1qjv9fh:
    plugin: eca_token_load_user_current
    label: Activity_1qjv9fh
    configuration:
      token_name: user
    successors:
      -
        id: Activity_0trx6uy
        condition: ''
