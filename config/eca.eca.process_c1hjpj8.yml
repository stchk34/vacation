uuid: ce41a040-3188-481b-b90a-3b521832f867
langcode: en
status: true
dependencies:
  config:
    - field.field.node.certificate.field_current_state_certificate
    - field.field.node.certificate.field_employee
    - field.field.node.certificate.field_limit_
    - field.field.node.certificate.field_start_date
    - field.field.node.certificate.field_use_up
    - field.field.node.transaction.field_certificate
    - field.field.node.transaction.field_days
    - field.field.node.transaction.field_owner
    - field.field.node.transaction.field_status_transactions
    - field.field.user.user.field_limit_of_weekends_per_year
    - field.storage.node.field_certificate
    - field.storage.node.field_current_state_certificate
    - field.storage.node.field_days
    - field.storage.node.field_employee
    - field.storage.node.field_limit_
    - field.storage.node.field_owner
    - field.storage.node.field_start_date
    - field.storage.node.field_status_transactions
    - field.storage.node.field_use_up
    - field.storage.user.field_limit_of_weekends_per_year
    - node.type.certificate
    - node.type.transaction
  module:
    - eca_content
    - eca_queue
    - eca_tamper
    - eca_user
    - user
id: process_c1hjpj8
modeller: bpmn_io
label: 'Create certificate'
version: ''
weight: null
events:
  Event_1d1setl:
    plugin: 'content_entity:insert'
    label: 'create user'
    configuration:
      type: 'user user'
    successors:
      -
        id: Activity_125agee
        condition: ''
  Event_11pyme6:
    plugin: 'eca_queue:processing_task'
    label: Event_11pyme6
    configuration:
      distribute: false
      task_name: 'first certificate'
      task_value: ''
      cron: ''
    successors:
      -
        id: Activity_1xtefdc
        condition: ''
  Event_1l3e4qj:
    plugin: 'eca_queue:processing_task'
    label: Event_1l3e4qj
    configuration:
      distribute: false
      task_name: 'second certificate'
      task_value: ''
      cron: ''
    successors:
      -
        id: Activity_1xtefdc
        condition: ''
  Event_1oyyi01:
    plugin: 'content_entity:custom'
    label: Event_1oyyi01
    configuration:
      event_id: x1
    successors:
      -
        id: Activity_1ft6l9k
        condition: ''
conditions: {  }
gateways: {  }
actions:
  Activity_125agee:
    plugin: eca_token_load_entity
    label: 'load user'
    configuration:
      token_name: new_user
      from: current
      entity_type: user
      entity_id: ''
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: ''
    successors:
      -
        id: Activity_156u9ex
        condition: ''
  Activity_156u9ex:
    plugin: eca_enqueue_task_delayed
    label: 'create queue'
    configuration:
      delay_value: '2'
      delay_unit: '60'
      task_name: 'first certificate'
      task_value: ''
      tokens: new_user
    successors: {  }
  Activity_1xtefdc:
    plugin: eca_switch_account
    label: 'switch to admin'
    configuration:
      user_id: '1'
    successors:
      -
        id: Activity_0d3w2yd
        condition: ''
  Activity_0d3w2yd:
    plugin: eca_new_entity
    label: 'create node'
    configuration:
      token_name: new_certificate
      type: 'node certificate'
      langcode: en
      label: Certificate
      published: true
      owner: '1'
    successors:
      -
        id: Activity_1m6ivmb
        condition: ''
  Activity_1dozkw8:
    plugin: eca_enqueue_task_delayed
    label: Activity_1dozkw8
    configuration:
      delay_value: '2'
      delay_unit: '60'
      task_name: 'second certificate'
      task_value: ''
      tokens: 'new_user, new_certificate'
    successors: {  }
  Activity_0qkj36z:
    plugin: eca_save_entity
    label: 'save node'
    configuration:
      object: '[new_certificate]'
    successors:
      -
        id: Activity_1dozkw8
        condition: ''
      -
        id: Activity_0cj0cv2
        condition: ''
  Activity_1m6ivmb:
    plugin: eca_set_field_value
    label: |-
      set field
      employee
    configuration:
      field_name: field_employee
      field_value: '[new_user]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: false
      object: '[new_certificate]'
    successors:
      -
        id: Activity_1y4ukue
        condition: ''
  Activity_1y4ukue:
    plugin: 'eca_tamper:math'
    label: 'calculate limit day'
    configuration:
      operation: division
      flip: false
      value: '2'
      eca_data: '[new_user:field_limit_of_weekends_per_year:value]'
      eca_token_name: limit_certificate
    successors:
      -
        id: Activity_0ipizh1
        condition: ''
  Activity_0ipizh1:
    plugin: eca_set_field_value
    label: 'set field Limit vacation'
    configuration:
      field_name: field_limit_
      field_value: '[limit_certificate]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: false
      object: '[new_certificate]'
    successors:
      -
        id: Activity_0zx5jkb
        condition: ''
  Activity_0zx5jkb:
    plugin: eca_set_field_value
    label: 'set field State'
    configuration:
      field_name: field_current_state_certificate
      field_value: state_certificate_publish
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: false
      object: '[new_certificate]'
    successors:
      -
        id: Activity_0c8ov6r
        condition: ''
  Activity_0c8ov6r:
    plugin: eca_set_field_value
    label: "set field\_ \_Start Date"
    configuration:
      field_name: field_start_date
      field_value: '[new_certificate:created:raw]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: false
      object: '[new_certificate]'
    successors:
      -
        id: Activity_0pjw78t
        condition: ''
  Activity_0pjw78t:
    plugin: 'eca_tamper:math'
    label: 'unpublish date value'
    configuration:
      operation: addition
      flip: false
      value: '240'
      eca_data: '[new_certificate:created:raw]'
      eca_token_name: unpublish_value
    successors:
      -
        id: Activity_188ofn2
        condition: ''
  Activity_188ofn2:
    plugin: eca_set_field_value
    label: "set field\_ \_USE UP"
    configuration:
      field_name: field_use_up
      field_value: '[unpublish_value]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: false
      object: '[new_certificate]'
    successors:
      -
        id: Activity_0qkj36z
        condition: ''
  Activity_0cj0cv2:
    plugin: eca_trigger_content_entity_custom_event
    label: TRIGGER
    configuration:
      event_id: x1
      tokens: ''
      object: '[new_certificate]'
    successors:
      -
        id: Activity_1x79y5v
        condition: ''
  Activity_1fzkk6m:
    plugin: eca_new_entity
    label: 'create EARNED TRANSACTION'
    configuration:
      token_name: earned_transaction
      type: 'node transaction'
      langcode: ''
      label: 'Transaction for [new_certificate:title]'
      published: true
      owner: '1'
    successors:
      -
        id: Activity_01mqdh5
        condition: ''
  Activity_1ft6l9k:
    plugin: eca_switch_account
    label: 'switch to admin'
    configuration:
      user_id: '1'
    successors:
      -
        id: Activity_1fzkk6m
        condition: ''
  Activity_01mqdh5:
    plugin: eca_set_field_value
    label: 'set field Status transaction'
    configuration:
      field_name: field_status_transactions
      field_value: transaction_type_earned
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: false
      object: '[earned_transaction]'
    successors:
      -
        id: Activity_1qnbmo4
        condition: ''
  Activity_1qnbmo4:
    plugin: eca_set_field_value
    label: 'set field Owner'
    configuration:
      field_name: field_owner
      field_value: '[new_certificate:field_employee:entity]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: false
      object: '[earned_transaction]'
    successors:
      -
        id: Activity_1b2r6jl
        condition: ''
  Activity_1b2r6jl:
    plugin: eca_set_field_value
    label: 'set field Days'
    configuration:
      field_name: field_days
      field_value: '[new_certificate:field_limit_:value]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: false
      object: '[earned_transaction]'
    successors:
      -
        id: Activity_0so27xc
        condition: ''
  Activity_0so27xc:
    plugin: eca_set_field_value
    label: 'set field Certificate'
    configuration:
      field_name: field_certificate
      field_value: '[certificate]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: false
      object: '[earned_transaction]'
    successors: {  }
  Activity_1x79y5v:
    plugin: action_message_action
    label: Activity_1x79y5v
    configuration:
      replace_tokens: false
      message: 'Створено сертифікат'
    successors: {  }
