uuid: 0b9b3a90-a19d-4f7c-961c-34e75b543671
langcode: en
status: true
dependencies:
  config:
    - field.field.node.transaction.field_days
    - field.field.node.transaction.field_owner
    - field.storage.node.field_days
    - field.storage.node.field_owner
    - node.type.transaction
  module:
    - eca_base
    - eca_content
    - eca_tamper
    - eca_user
id: process_y1c5fly
modeller: bpmn_io
label: 'Config balance'
version: ''
weight: null
events:
  Event_1u0zm6n:
    plugin: 'content_entity:insert'
    label: 'create Transaction'
    configuration:
      type: 'node transaction'
    successors:
      -
        id: Activity_03a6ntd
        condition: ''
conditions:
  Flow_0fvi0kl:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[new_transaction:field_type_transaction:value]'
      right: Spent
      operator: equal
      type: value
  Flow_17jrzw0:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[new_transaction:field_type_transaction:value]'
      right: Earned
      operator: equal
      type: value
  Flow_1auxihj:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[new_transaction:field_type_transaction:value]'
      right: 'Spent when burning day'
      operator: equal
      type: value
gateways:
  Gateway_0oklceq:
    type: 0
    successors:
      -
        id: Activity_1mxmweh
        condition: Flow_0fvi0kl
      -
        id: Activity_1e6k35j
        condition: Flow_17jrzw0
      -
        id: Activity_1brxwjf
        condition: Flow_1auxihj
actions:
  Activity_03a6ntd:
    plugin: eca_switch_account
    label: 'switch user'
    configuration:
      user_id: '1'
    successors:
      -
        id: Activity_0ht22ta
        condition: ''
  Activity_1e6k35j:
    plugin: eca_token_load_entity_ref
    label: 'owner earned transaction'
    configuration:
      field_name_entity_ref: field_owner
      token_name: owner_earned_transaction
      from: current
      entity_type: _none
      entity_id: ''
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: ''
    successors:
      -
        id: Activity_1ojtzlu
        condition: ''
  Activity_1brxwjf:
    plugin: eca_token_load_entity_ref
    label: 'onwer burning day transaction'
    configuration:
      field_name_entity_ref: field_owner
      token_name: owner_burning_day_transaction
      from: current
      entity_type: _none
      entity_id: ''
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: ''
    successors: {  }
  Activity_0ht22ta:
    plugin: eca_token_load_entity
    label: 'load transaction'
    configuration:
      token_name: new_transaction
      from: current
      entity_type: _none
      entity_id: ''
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: ''
    successors:
      -
        id: Gateway_0oklceq
        condition: ''
  Activity_1mxmweh:
    plugin: eca_token_load_entity_ref
    label: 'owner spent transaction'
    configuration:
      field_name_entity_ref: field_owner
      token_name: owner_transaction_spent
      from: current
      entity_type: _none
      entity_id: ''
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: ''
    successors:
      -
        id: Activity_1g4t94f
        condition: ''
  Activity_1g4t94f:
    plugin: 'eca_tamper:math'
    label: 'Balance user after vacation request'
    configuration:
      operation: subtraction
      flip: false
      value: '[new_transaction:field_days:value]'
      eca_data: '[owner_transaction_spent:field_balance_a_vacations_day:value]'
      eca_token_name: balance_after_request
    successors:
      -
        id: Activity_1lkc2ag
        condition: ''
  Activity_1lkc2ag:
    plugin: eca_set_field_value
    label: 'Set field balance user'
    configuration:
      field_name: field_balance_a_vacations_day
      field_value: '[balance_after_request]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: '[owner_transaction_spent]'
    successors: {  }
  Activity_1ojtzlu:
    plugin: 'eca_tamper:math'
    label: 'Balance user after publish certificate'
    configuration:
      operation: addition
      flip: false
      value: '[new_transaction:field_days:value]'
      eca_data: '[owner_earned_transaction:field_balance_a_vacations_day:value]'
      eca_token_name: balance_after_publish_certificate
    successors:
      -
        id: Activity_1xupkh9
        condition: ''
  Activity_1xupkh9:
    plugin: eca_set_field_value
    label: 'set field balance user'
    configuration:
      field_name: field_balance_a_vacations_day
      field_value: '[balance_after_publish_certificate]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: owner_earned_transaction
    successors: {  }
