uuid: 9154adde-c0d5-44d0-b6cb-4a5272ef672f
langcode: en
status: true
dependencies:
  config:
    - field.field.node.certificate.field_employee
    - field.field.node.certificate.field_limit_
    - field.field.node.transaction.field_created_date
    - field.field.node.transaction.field_days
    - field.field.node.transaction.field_owner
    - field.field.node.transaction.field_type_transaction
    - field.storage.node.field_created_date
    - field.storage.node.field_days
    - field.storage.node.field_employee
    - field.storage.node.field_limit_
    - field.storage.node.field_owner
    - field.storage.node.field_type_transaction
    - node.type.certificate
    - node.type.transaction
  module:
    - eca_base
    - eca_content
    - eca_user
id: process_mnpyrtg
modeller: bpmn_io
label: 'Create earned transaction after publish certificate'
version: ''
weight: null
events:
  Event_1quutac:
    plugin: 'content_entity:update'
    label: 'upd certificate'
    configuration:
      type: 'node certificate'
    successors:
      -
        id: Activity_0qykfe1
        condition: ''
conditions:
  Flow_0q7wfwp:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[upd_certificate:field_current_state_certificate:value]'
      right: state_certificate_publish
      operator: equal
      type: value
  Flow_0glrjsd:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[upd_certificate:field_current_state_certificate:value]'
      right: state_certificate_disabled
      operator: equal
      type: value
gateways:
  Gateway_097ljag:
    type: 0
    successors:
      -
        id: Activity_1jtw2xe
        condition: Flow_0q7wfwp
      -
        id: Activity_1dgp9uc
        condition: Flow_0glrjsd
actions:
  Activity_1r7hxy3:
    plugin: eca_switch_account
    label: 'switch to admin'
    configuration:
      user_id: '1'
    successors:
      -
        id: Gateway_097ljag
        condition: ''
  Activity_1jtw2xe:
    plugin: eca_new_entity
    label: 'Create earned transaction'
    configuration:
      token_name: earned_transaction
      type: 'node transaction'
      langcode: ''
      label: 'Transaction from certificate [upd_certificate:nid]'
      published: true
      owner: '1'
    successors:
      -
        id: Activity_05tsizx
        condition: ''
  Activity_0qykfe1:
    plugin: eca_token_load_entity
    label: 'load upd_certificate'
    configuration:
      token_name: upd_certificate
      from: current
      entity_type: _none
      entity_id: ''
      revision_id: ''
      properties: ''
      langcode: _interface
      latest_revision: false
      unchanged: false
      object: ''
    successors:
      -
        id: Activity_1r7hxy3
        condition: ''
  Activity_00m7r91:
    plugin: eca_save_entity
    label: 'Save transaction'
    configuration:
      object: '[earned_transaction]'
    successors: {  }
  Activity_05tsizx:
    plugin: eca_set_field_value
    label: 'set field "owner"'
    configuration:
      field_name: field_owner
      field_value: '[upd_certificate:field_employee:entity]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: '[earned_transaction]'
    successors:
      -
        id: Activity_1bc6wsi
        condition: ''
  Activity_1bc6wsi:
    plugin: eca_set_field_value
    label: 'set field Earned type'
    configuration:
      field_name: field_type_transaction
      field_value: Earned
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: '[earned_transaction]'
    successors:
      -
        id: Activity_0xgec81
        condition: ''
  Activity_0xgec81:
    plugin: eca_set_field_value
    label: 'set Days'
    configuration:
      field_name: field_days
      field_value: '[upd_certificate:field_limit_:value]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: '[earned_transaction]'
    successors:
      -
        id: Activity_00m7r91
        condition: ''
  Activity_1dgp9uc:
    plugin: eca_new_entity
    label: 'create Transaction "operation of burning days in the certificate"'
    configuration:
      token_name: burning_day_transaction
      type: 'node transaction'
      langcode: ''
      label: 'Burning day from Certificate [upd_certificate:nid]'
      published: true
      owner: '1'
    successors:
      -
        id: Activity_0cb369m
        condition: ''
  Activity_0cb369m:
    plugin: eca_set_field_value
    label: 'set field owner'
    configuration:
      field_name: field_owner
      field_value: '[upd_certificate:field_employee:entity]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: '[burning_day_transaction]'
    successors:
      -
        id: Activity_1lo8wgt
        condition: ''
  Activity_1lo8wgt:
    plugin: eca_set_field_value
    label: 'set field "Created date"'
    configuration:
      field_name: field_created_date
      field_value: '[current-date:raw]'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: '[burning_day_transaction]'
    successors:
      -
        id: Activity_0qja3c8
        condition: ''
  Activity_0qja3c8:
    plugin: eca_set_field_value
    label: 'set field "Spent when burning day"'
    configuration:
      field_name: field_type_transaction
      field_value: 'Spent when burning day'
      method: 'set:clear'
      strip_tags: false
      trim: false
      save_entity: true
      object: '[burning_day_transaction]'
    successors:
      -
        id: Activity_04b5lyp
        condition: ''
  Activity_04b5lyp:
    plugin: eca_save_entity
    label: 'save transaction'
    configuration:
      object: '[burning_day_transaction]'
    successors: {  }
